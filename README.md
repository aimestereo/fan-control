# fan-control

The intent of this script package to provide a (relatively) simple means of controlling fan speed via a fan curve. It is one monolithic script to manage TrueNAS Core, pfSense, and Proxmox.
It includes a means of running as a service, including reading the configuration regularly for changes so you can make adjustments without needing to reboot/start the script in odd ways on different platforms.

# Some explanation is required

There are a number of specific tools like this for each of the platforms, but I've been unsatisified with most and the one I do like was in Ruby, which isn't quite as cross-platform as I'd like. I recreated the script in Python, added a means of checking HDD temps, and then made necessary changes depending on platform for checking things like CPU temps and whatnot.

There are a number of areas that, in my incredibly amateur opinion, are incredibly amateur. My goal for sharing it is to hopefully get it out there so those with a better understanding of these platforms and Python can take it and make it better. If not, hey, I know it works (or at least it seems to work) for me.

# TrueNAS Core Caveat

Due to how TrueNAS works, setting the script to start on boot needs to be performed by the user. If you'd set that up and would then like to disable the script from auto-starting, you also need to do that on your own.

It might be possible to do this via the install/uninstall shell scripts but I didn't do much research into it as from what I can tell the other IPMI fan control scripts don't do anything like this either, so I kind of assume it's not a thing.

# Tested Against

My personal machines are as follows:
pfSense - Supermicro X11SSH-LN4F in a Supermicro CSE-512F-350B chassis
TrueNAS Core - Supermicro X10DRH-C in a Supermicro 36 3.5" + 2 2.5" chassis (not sure of exact model)
Proxmox - Dell Poweredge R730xd

Depending on yourself editing the config file appropriately should just work, but it was written to work against these systems and thus I can't guarantee it'll work against anything different.

# Install / Uninstall

Unzip everything into /root/fan-control
execute the install.sh script, follow the instructions. It will copy the appropriate files for your OS, mark as executable, do what it can so things auto start on boot, open the config generator for you, execute it, and start the script.

To uninstall, there is a matching uninstall.sh script. However, I do not script the removal of /root/fan-control, I only do what I can to stop the script and either remove the auto-start components or instruct you how to.

# TODO

I'd like to reach a point where this is less monolithic and more modular. I'd like a means of detecting OS, potentially detecting the IPMI platform, and having individual modular components for each so it can grow/add platforms and OSs more easily. Some of this I know I could do now, but as is for just 2 IPMI platforms and 3 OS's (two which are almost identical) I know how I'm doing things now works well enough.

I'd also like to work the install/uninstall scripts to be a bit more user friendly. I'm fairly happy with out I setup gen-config.py but it might be interesting to build a means of having the install script "dump" a gen-config.py that is generated by the user during the install process.
